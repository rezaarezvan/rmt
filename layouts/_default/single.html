{{ define "main" }}
<main>
    <article>
        <div class="title">
            <h1>{{ .Title }}</h1>
            {{- $pubdate := .PublishDate.Format "Jan 2, 2006" }}
            <div class="meta">Posted on {{ $pubdate }}{{ if .Draft }} <span class="draft-label">DRAFT</span>{{ end }}
            </div>

            {{- if .Lastmod }}
            {{- $lastmod := .Lastmod.Format "Jan 2, 2006" }}
            {{- if ne $lastmod $pubdate }}
            <div class="meta">
                (Last updated: {{ $lastmod }})
            </div>
            {{- end }}
            {{- end }}

        </div>
        {{ if isset .Params "tldr" }}
        <div class="tldr">
            <strong>tl;dr:</strong> {{ .Params.tldr }}
        </div>
        {{ end }}
        <section class="body">
            {{ .Content }}
        </section>
    </article>

    <nav class="navigation">
        {{ $currentTerm := index .Params.school 0 }}
        {{ $filteredPosts := where (where .Site.RegularPages "Type" "school") ".Params.school" "intersect" (slice
        $currentTerm) }}
        {{ $sortedPosts := $filteredPosts.ByDate }}
        {{ $currentIndex := -1 }}
        {{ range $index, $element := $sortedPosts }}
        {{ if eq $element.RelPermalink $.RelPermalink }}
        {{ $currentIndex = $index }}
        {{ end }}
        {{ end }}

        {{ $hasPrevious := gt $currentIndex 0 }}
        {{ $hasNext := lt $currentIndex (sub (len $sortedPosts) 1) }}

        <div class="nav-item previous">
            {{ if $hasPrevious }}
            {{ with index $sortedPosts (sub $currentIndex 1) }}
            <a href="{{ .RelPermalink }}" title="Previous: {{ .Title }}">&larr; Previous</a>
            {{ end }}
            {{ end }}
        </div>

        <div class="nav-item next">
            {{ if $hasNext }}
            {{ with index $sortedPosts (add $currentIndex 1) }}
            <a href="{{ .RelPermalink }}" title="Next: {{ .Title }}">Next &rarr;</a>
            {{ end }}
            {{ end }}
        </div>
    </nav>
</main>
{{ end }}
